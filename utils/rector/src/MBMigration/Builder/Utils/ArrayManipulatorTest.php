<?php

namespace Utils\Rector\MBMigration\Builder\Utils;

use MBMigration\Builder\Utils\ArrayManipulator;
use PHPUnit\Framework\TestCase;

class ArrayManipulatorTest extends TestCase
{
    /**
     * @var ArrayManipulator|null
     */
    private $arrayManipulator = null;

    /**
     * Setup function for every test. It initialises the ArrayManipulator.
     */
    protected function setUp(): void
    {
        $this->arrayManipulator = new ArrayManipulator();
    }

    /**
     * Test function for the groupArrayByParentId method of the ArrayManipulator class.
     */
    public function testGroupArrayByParentId()
    {
        $list = json_decode("[{\"id\":25511639,\"category\":\"photo\",\"item_type\":null,\"order_by\":0,\"group\":0,\"parent_id\":null,\"settings\":{\"slide\":{\"fit\":false,\"mobile_fit\":null,\"slide_height\":null,\"slide_width\":null,\"mobile_height\":null,\"mobile_width\":null,\"extension\":\"jpg\",\"mobile_extension\":\"jpg\"}},\"link\":null,\"new_window\":false,\"content\":\"9faf442e-3ae2-40f3-ad8c-efd4d448aa23.jpg\"},{\"id\":13051042,\"category\":\"list\",\"item_type\":null,\"order_by\":0,\"group\":1,\"parent_id\":null,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":null},{\"id\":13051041,\"category\":\"list\",\"item_type\":null,\"order_by\":0,\"group\":1,\"parent_id\":null,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":null},{\"id\":13051040,\"category\":\"list\",\"item_type\":null,\"order_by\":0,\"group\":1,\"parent_id\":null,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":null},{\"id\":13051051,\"category\":\"photo\",\"item_type\":null,\"order_by\":0,\"group\":0,\"parent_id\":13051042,\"settings\":{\"image\":{\"height\":360,\"width\":640,\"alt\":\"\"}},\"link\":null,\"new_window\":false,\"content\":\"5cd2f398-5fc0-43c7-b399-dd6d13c15bbf.jpg\"},{\"id\":13051052,\"category\":\"text\",\"item_type\":\"title\",\"order_by\":1,\"group\":0,\"parent_id\":13051042,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp style\\u003d\\\"color: rgb(255, 255, 255);\\\"\\u003eFirst time at\\u003c/p\\u003e\\u003cp style\\u003d\\\"color: rgb(255, 255, 255);\\\"\\u003eNew Life?\\u0026nbsp;\\u003c/p\\u003e\"},{\"id\":13051053,\"category\":\"text\",\"item_type\":\"body\",\"order_by\":2,\"group\":0,\"parent_id\":13051042,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp style\\u003d\\\"color: rgb(255, 255, 255); font-weight: 600;\\\"\\u003e\\u003cspan class\\u003d\\\"clovercustom\\\" style\\u003d\\\"font-weight: 200;\\\"\\u003eIt is an honor and a joy to be able to connect with you and to be able to tell you all the good things God is doing at our locations.\\u003c/span\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cstyle\\u003e\\n\\n\\u003c/style\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cstyle\\u003e\\n\\n\\u003c/style\\u003e\\u003c/p\\u003e\"},{\"id\":13051054,\"category\":\"button\",\"item_type\":null,\"order_by\":3,\"group\":0,\"parent_id\":13051042,\"settings\":[],\"link\":\"what-we-believe\",\"new_window\":false,\"content\":\"\\u003cp\\u003eWHAT WE BELIEVE\\u003c/p\\u003e\"},{\"id\":13051047,\"category\":\"photo\",\"item_type\":null,\"order_by\":0,\"group\":0,\"parent_id\":13051041,\"settings\":{\"image\":{\"height\":360,\"width\":640,\"alt\":\"\"}},\"link\":null,\"new_window\":false,\"content\":\"dd85720f-4be4-4441-9932-6c8213a6b60c.jpg\"},{\"id\":13051048,\"category\":\"text\",\"item_type\":\"title\",\"order_by\":1,\"group\":0,\"parent_id\":13051041,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp\\u003e\\u003cspan class\\u003d\\\"clovercustom\\\" style\\u003d\\\"color: rgb(255, 255, 255);\\\"\\u003eOur Services\\u003c/span\\u003e\\u003c/p\\u003e\"},{\"id\":13051049,\"category\":\"text\",\"item_type\":\"body\",\"order_by\":2,\"group\":0,\"parent_id\":13051041,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp style\\u003d\\\"color: rgb(255, 255, 255);\\\"\\u003eWe have two campuses. Each campus is unique with it\\u0027s own flavor but with the same heart and vision of helping people discover God\\u0027s love and purpose for their lives.\\u003c/p\\u003e\"},{\"id\":13051050,\"category\":\"button\",\"item_type\":null,\"order_by\":3,\"group\":0,\"parent_id\":13051041,\"settings\":[],\"link\":\"services\",\"new_window\":false,\"content\":\"\\u003cp\\u003eJoin us Sunday\\u003c/p\\u003e\"},{\"id\":13051043,\"category\":\"photo\",\"item_type\":null,\"order_by\":0,\"group\":0,\"parent_id\":13051040,\"settings\":{\"image\":{\"height\":360,\"width\":640}},\"link\":null,\"new_window\":false,\"content\":\"ee1e218c-3fac-4c9f-9b61-0d27c7b2e0eb.jpg\"},{\"id\":13051044,\"category\":\"text\",\"item_type\":\"title\",\"order_by\":1,\"group\":0,\"parent_id\":13051040,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp\\u003e\\u003cspan class\\u003d\\\"clovercustom\\\" style\\u003d\\\"color: rgb(255, 255, 255);\\\"\\u003eOutreach \\u003cbr\\u003e\\u003c/span\\u003e\\u003c/p\\u003e\"},{\"id\":13051045,\"category\":\"text\",\"item_type\":\"body\",\"order_by\":2,\"group\":0,\"parent_id\":13051040,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp style\\u003d\\\"color: rgb(255, 255, 255);\\\"\\u003eAt New Life we believe in supporting Christian programs through donations and volunteering. We strive to be the hands of feet of God here on earth.\\u003cbr\\u003e\\u003c/p\\u003e\"},{\"id\":13051046,\"category\":\"button\",\"item_type\":null,\"order_by\":3,\"group\":0,\"parent_id\":13051040,\"settings\":[],\"link\":\"outreach\",\"new_window\":false,\"content\":\"\\u003cp\\u003e\\u0026nbsp; \\u0026nbsp; \\u0026nbsp; \\u0026nbsp;Learn\\u0026nbsp; \\u0026nbsp; \\u0026nbsp; \\u0026nbsp;\\u003c/p\\u003e\\u003cp\\u003eMore\\u003c/p\\u003e\"}]", true);
        $list = json_decode("[{\"id\":13195028,\"category\":\"text\",\"item_type\":\"title\",\"order_by\":0,\"group\":1,\"parent_id\":null,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp\\u003eSunday Gathering\\u003c/p\\u003e\"},{\"id\":13195027,\"category\":\"photo\",\"item_type\":null,\"order_by\":0,\"group\":0,\"parent_id\":null,\"settings\":{\"image\":{\"height\":718,\"width\":718}},\"link\":\"https://www.google.com/maps/dir//433+Barney+Ave,+Millen,+GA+30442/@32.8088275,-81.9423848,17z/data\\u003d!4m8!4m7!1m0!1m5!1m1!1s0x88fa1e1a65272c67:0x183f58558b2567ce!2m2!1d-81.9401961!2d32.8088275\",\"new_window\":true,\"content\":\"4d68d35d-249a-4b4c-b565-06bd1aa1dabb.jpg\"},{\"id\":13195029,\"category\":\"text\",\"item_type\":\"body\",\"order_by\":1,\"group\":1,\"parent_id\":null,\"settings\":[],\"link\":null,\"new_window\":false,\"content\":\"\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003eWe believe that Sunday mornings should be a time that we celebrate what God has been doing in us all week.\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003eOur Sunday morning Gatherings are a time to worship, teach, and spend time in prayer together. Our services are not our primary focus of ministry, but complimentary.\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003eService starts at 11:00 AM:\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003eJenkins County High School\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003e433 Barney Avenue\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003eMillen, Ga. 30442\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003e(Church Entrance behind gymnasium on North Avenue)\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003c/p\\u003e\\u003ccenter\\u003e\\u003cp style\\u003d\\\"font-size: 1.3298em;\\\"\\u003e\\u0026nbsp;\\u003ca href\\u003d\\\"https://www.google.com/maps/place/32%C2%B048\\u002741.1%22N+81%C2%B056\\u002738.0%22W/@32.8114167,-81.9438889,734m/data\\u003d!3m2!1e3!4b1!4m6!3m5!1s0x0:0x0!7e2!8m2!3d32.8114063!4d-81.9438789\\\" class\\u003d\\\"sites-button cloverlinks\\\" role\\u003d\\\"button\\\" data-location\\u003d\\\"external\\\" data-detail\\u003d\\\"https://www.google.com/maps/place/32%C2%B048\\u002741.1%22N+81%C2%B056\\u002738.0%22W/@32.8114167,-81.9438889,734m/data\\u003d!3m2!1e3!4b1!4m6!3m5!1s0x0:0x0!7e2!8m2!3d32.8114063!4d-81.9438789\\\" data-category\\u003d\\\"button\\\" target\\u003d\\\"_blank\\\"\\u003eGet Directions Here\\u003c/a\\u003eâ€Š\\u003c/p\\u003e\\u003c/center\\u003e\\u003cp\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\\u003cp\\u003e\\u003cbr\\u003e\\u003c/p\\u003e\"}]", true);
        $list = json_decode("[{\"type\":\"Wrapper\",\"value\":{\"_styles\":[\"wrapper\",\"wrapper-ministryBrands\"],\"items\":[{\"type\":\"MinistryBrandsSermonFeatured\",\"value\":{\"_styles\":[\"ministryBrandsSermonFeatured\"],\"titleTypographyFontStyle\":\"heading3\",\"titleColorPalette\":\"\",\"hoverTitleColorPalette\":\"\",\"typographyFontStyle\":\"heading6\",\"colorPalette\":\"\",\"previewTypographyFontStyle\":\"paragraph\",\"previewColorPalette\":\"\",\"detailButtonTypographyFontStyle\":\"button\",\"detailButtonColorPalette\":\"color8\",\"detailButtonBgColorPalette\":\"color3\",\"hoverDetailButtonBgColorOpacity\":0.8,\"metaLinksColorPalette\":\"\",\"_id\":\"ansodaqjoaogdztvuyjuwhkeejbcjtef\",\"tabsCurrentElement\":\"tabSettings\",\"sermonRecentList\":\"\",\"sermonLatest\":\"off\",\"sermonSlug\":\"text-to-give\",\"showMetaIcons\":\"off\",\"showImage\":\"on\",\"tabsState\":\"normal\",\"titleColorHex\":\"#62701c\",\"titleColorOpacity\":1,\"tempTitleColorOpacity\":1,\"tempTitleColorPalette\":\"\",\"colorHex\":\"#024e69\",\"colorOpacity\":1,\"tempColorOpacity\":1,\"tempColorPalette\":\"\",\"previewColorHex\":\"#03243a\",\"previewColorOpacity\":1,\"tempPreviewColorOpacity\":1,\"tempPreviewColorPalette\":\"\",\"metaLinksColorHex\":\"#62701c\",\"metaLinksColorOpacity\":1,\"tempMetaLinksColorOpacity\":1,\"tempMetaLinksColorPalette\":\"\",\"parentCategory\":\"give\",\"showCategoryFilter\":\"off\",\"hoverTitleColorHex\":\"#62701c\",\"hoverTitleColorOpacity\":0.7,\"hoverMetaLinksColorHex\":\"#62701c\",\"hoverMetaLinksColorOpacity\":0.7,\"hoverMetaLinksColorPalette\":\"\",\"showVideo\":\"on\",\"showTitle\":\"off\",\"showDate\":\"off\",\"showCategory\":\"off\",\"showPreacher\":\"off\",\"showPassage\":\"off\",\"showMetaHeadings\":\"off\",\"showContent\":\"off\",\"showMediaLinks\":\"off\"}}],\"_id\":\"ymvjztkxsxfumewbafokvuyapsdzlztt\"}},{\"type\":\"Wrapper\",\"value\":{\"_styles\":[\"wrapper\",\"wrapper-ministryBrands\"],\"items\":[{\"type\":\"MinistryBrandsSermonFeatured\",\"value\":{\"_styles\":[\"ministryBrandsSermonFeatured\"],\"titleTypographyFontStyle\":\"heading2\",\"titleColorPalette\":\"\",\"hoverTitleColorPalette\":\"\",\"typographyFontStyle\":\"heading6\",\"colorPalette\":\"\",\"previewTypographyFontStyle\":\"paragraph\",\"previewColorPalette\":\"\",\"detailButtonTypographyFontStyle\":\"button\",\"detailButtonColorPalette\":\"color8\",\"detailButtonBgColorPalette\":\"color3\",\"hoverDetailButtonBgColorOpacity\":0.8,\"metaLinksColorPalette\":\"\",\"_id\":\"xENW74aev1ok\",\"tabsCurrentElement\":\"tabSermonDisplay\",\"sermonRecentList\":\"\",\"showVideo\":\"off\",\"sermonLatest\":\"off\",\"sermonSlug\":\"text-to-give\",\"tabsState\":\"normal\",\"titleColorHex\":\"#ebeff2\",\"titleColorOpacity\":1,\"tempTitleColorOpacity\":1,\"tempTitleColorPalette\":\"\",\"hoverTitleColorHex\":\"#ebeff2\",\"hoverTitleColorOpacity\":1,\"tempHoverTitleColorOpacity\":0.83,\"tempHoverTitleColorPalette\":\"\",\"metaLinksColorHex\":\"#62701c\",\"metaLinksColorOpacity\":1,\"tempMetaLinksColorOpacity\":1,\"tempMetaLinksColorPalette\":\"\",\"hoverMetaLinksColorHex\":\"#62701c\",\"hoverMetaLinksColorOpacity\":0.78,\"hoverMetaLinksColorPalette\":\"\",\"tempHoverMetaLinksColorOpacity\":0.79,\"tempHoverMetaLinksColorPalette\":\"\",\"showMediaLinks\":\"off\",\"showCategory\":\"off\",\"parentBgColorType\":\"solid\",\"tempParentBgColorType\":\"solid\",\"parentBgColorHex\":\"#7995a8\",\"parentBgColorOpacity\":1,\"tempParentBgColorOpacity\":1,\"parentBgColorPalette\":\"\",\"tempParentBgColorPalette\":\"\",\"parentGradientColorHex\":\"#000000\",\"parentGradientColorOpacity\":1,\"tempParentGradientColorOpacity\":1,\"parentGradientColorPalette\":\"\",\"tempParentGradientColorPalette\":\"\",\"parentGradientType\":\"linear\",\"parentGradientStartPointer\":0,\"parentGradientFinishPointer\":100,\"parentGradientActivePointer\":\"finishPointer\",\"parentGradientLinearDegree\":45,\"parentGradientRadialDegree\":0,\"colorHex\":\"#ebeff2\",\"colorOpacity\":1,\"tempColorOpacity\":1,\"tempColorPalette\":\"\",\"previewColorHex\":\"#ebeff2\",\"previewColorOpacity\":1,\"tempPreviewColorOpacity\":1,\"tempPreviewColorPalette\":\"\",\"itemSpacing\":2,\"itemSpacingSuffix\":\"px\",\"bgPaddingType\":\"grouped\",\"bgPadding\":28,\"tempBgPadding\":0,\"bgPaddingSuffix\":\"px\",\"tempBgPaddingSuffix\":\"px\",\"bgPaddingTop\":28,\"tempBgPaddingTop\":28,\"bgPaddingTopSuffix\":\"px\",\"tempBgPaddingTopSuffix\":\"px\",\"bgPaddingRight\":28,\"tempBgPaddingRight\":28,\"bgPaddingRightSuffix\":\"px\",\"tempBgPaddingRightSuffix\":\"px\",\"bgPaddingBottom\":28,\"tempBgPaddingBottom\":28,\"bgPaddingBottomSuffix\":\"px\",\"tempBgPaddingBottomSuffix\":\"px\",\"bgPaddingLeft\":28,\"tempBgPaddingLeft\":28,\"bgPaddingLeftSuffix\":\"px\",\"tempBgPaddingLeftSuffix\":\"px\"}}],\"_id\":\"wTp1hls52OIR\",\"marginType\":\"ungrouped\",\"margin\":0,\"tempMargin\":0,\"marginSuffix\":\"px\",\"tempMarginSuffix\":\"px\",\"marginTop\":-11,\"tempMarginTop\":-10,\"marginTopSuffix\":\"px\",\"tempMarginTopSuffix\":\"px\",\"marginRight\":0,\"tempMarginRight\":0,\"marginRightSuffix\":\"px\",\"tempMarginRightSuffix\":\"px\",\"marginBottom\":0,\"tempMarginBottom\":0,\"marginBottomSuffix\":\"px\",\"tempMarginBottomSuffix\":\"px\",\"marginLeft\":0,\"tempMarginLeft\":0,\"marginLeftSuffix\":\"px\",\"tempMarginLeftSuffix\":\"px\"}}]", true);

        $result = $this->arrayManipulator->groupItemsListByParentId($list, 'gallery');

        $expected = [
            123 => [
                'parent_id' => null,
                'id' => 123,
                'content' => null,
                'category' => 'list',
                'order_by' => 2,
                'item' => [
                    [
                        'parent_id' => 123,
                        'id' => 456,
                        'content' => 'child',
                        'category' => 'list',
                        'order_by' => 1
                    ]
                ]
            ]
        ];

        $this->assertEquals($expected, $result);
    }

    /**
     * Teardown function for every test. It cleans up the ArrayManipulator.
     */
    protected function tearDown(): void
    {
        $this->arrayManipulator = null;
    }
}
